var FlexWhale;!function(e){var t;!function(e){var t=function(){function e(){}return e.prototype.filter=function(e,t,o){if(0===o.length)return e;for(var i=new Array,n=0;n<e.length;n++){var s=e[n];-1!==s[t].toLowerCase().indexOf(o.toLowerCase())&&i.push(s)}return i},e}();e.ContainsFilterController=t}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={}));var FlexWhale;!function(e){var t;!function(e){var t;!function(e){e[e.Selected=0]="Selected",e[e.UnSelected=1]="UnSelected"}(t||(t={}));var o=function(){function o(t,o,i,n,s,a,l,p){this._grouped=!1,this._multiSelection=!1,this._onSelectionChanged=new e.LiteEvent,this._selectedItems=t,this._itemTemplate=l,this._headerGroupTemplate=p,this._messages=o,this._displayExpr=i,this._grouped=n,this._groupExpr=s,this._multiSelection=a}return Object.defineProperty(o.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){this._selectedItems=e,this._onSelectionChanged.trigger(this._selectedItems)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onSelectionChanged",{get:function(){return this._onSelectionChanged},enumerable:!0,configurable:!0}),o.prototype.getView=function(e){var t=$("<div/>");if(t.addClass("flexWhale-listLayout"),e&&e.length>0){var o=void 0;o=this._grouped===!1?this.getPlainViewItems(e):this.getGroupsViewItems(e),t.append(o)}else{var i=$("<span>"+this._messages.noDataMessage+"</span>");i.addClass("flexWhale-noDataLabel"),t.append(i)}return t},o.prototype.onClickedItem=function(e,o){if(this._multiSelection)if(o===t.Selected)this._selectedItems.push(e);else{if(o!==t.UnSelected)throw new Error("InvalidOperationException");this._selectedItems.splice(this._selectedItems.indexOf(e),1)}else this._selectedItems=[e];this._onSelectionChanged.trigger(this._selectedItems)},o.prototype.getGroupsViewItems=function(e){for(var t=new Array,o={},i=0;i<e.length;i++){var n=e[i],s=n[this._groupExpr],a=this.getListItem(n,-1!==this._selectedItems.indexOf(n));o[s]?o[s].push(a):o[s]=new Array(a)}for(var l in o)if(o.hasOwnProperty(l)){var p=$("<div/>"),r=o[l],u=$("<div/>");u.append(r),p.append(this.getViewHeaderGroup(l,r)),p.append(u),t.push(p)}return t},o.prototype.getViewHeaderGroup=function(t,o){var i=$("<div/>"),n=void 0;return this._headerGroupTemplate&&(n=this._headerGroupTemplate(new e.HeaderGroupTemplateArgs(o,t))),i.addClass("flexWhale-headerGroup"),void 0!==n?i.append(n):i.append(t),i},o.prototype.getPlainViewItems=function(e){for(var t=new Array,o=0;o<e.length;o++){var i=e[o],n=this.getListItem(i,-1!==this._selectedItems.indexOf(i));t.push(n)}return t},o.prototype.getListItem=function(e,o){var i=this,n=$("<div/>");n.addClass("flexWhale-listItem");var s=$("<div/>");if(s.addClass("flexWhale-listItemContent"),this._multiSelection){var a=$("<div/>");a.addClass("flexWhale-checkBoxColumn");var l=$("<div/>");l.addClass("flexWhale-imageLibary-check"),o===!1&&l.hide(),a.append(l),n.append(a),s.addClass("flexWhale-listItemContent_multiSelection")}var p=void 0;return void 0!==this._itemTemplate&&(p=this._itemTemplate(e)),p||(p=e[this._displayExpr]),s.append(p),n.append(s),n.on("click",e,function(e){var o=-1!==i._selectedItems.indexOf(e.data);i._multiSelection&&(o?(n.removeClass("flexWhale-listItem_selected"),l.hide()):(n.addClass("flexWhale-listItem_selected"),l.show())),i.onClickedItem(e.data,o?t.UnSelected:t.Selected)}),o&&n.addClass("flexWhale-listItem_selected"),n},o}();e.ListControl=o}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={}));var FlexWhale;!function(e){var t;!function(e){var t=function(){function t(t,o,i,n){this._filterController=new e.ContainsFilterController,this._dataSource=t,this._listControl=i,this._displayExpr=o,this._isVisibleSearchPanel=n}return Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){this._dataSource=e},enumerable:!0,configurable:!0}),t.prototype.setFocus=function(){this._$searchBox&&this._$searchBox.focus()},t.prototype.getView=function(){var e=this,t=$("<div/>");t.addClass("flexWhale-lookupContent");var o=this.getListContainer();if(this._isVisibleSearchPanel){var i=$("<div/>");i.addClass("flexWhale-lookupContent-searchPanel"),t.append(i);var n=this._$searchBox=$("<input/>");n.attr("spellcheck","false"),n.attr("autocomplete","off"),n.keyup(function(t){o.empty();var i=e._filterController.filter(e._dataSource,e._displayExpr,n.val());o.append(e._listControl.getView(i))}),n.addClass("flexWhale-lookupContent-searchTextBox"),i.append(n)}return o.append(this._listControl.getView(this._dataSource)),t.append(o),t},t.prototype.getListContainer=function(){var e=$("<div/>");return e.addClass("flexWhale-listContainer"),this._isVisibleSearchPanel?e.addClass("flexWhale-listContainer_withSearchPanel"):e.addClass("flexWhale-listContainer_withoutSearchPanel"),e},t}();e.PopupContentControl=t}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={}));var FlexWhale;!function(e){var t;!function(e){var t=function(){function t(t,o){if(this._isInit=!1,this._dataSource=new Array,this._selectedItems=new Array,"undefined"==typeof jQuery)throw new Error("Lookup requires jQuery");this._$panel=$(t),this._options=o;var i=this;this._options.dataSource&&(this._dataSource=this._options.dataSource),this._options.selectedItems&&(this._selectedItems=this._options.selectedItems);var n=this._listControl=new e.ListControl(this._selectedItems,o.messages,o.displayExpr,o.grouped,o.groupExpr,o.multiSelection,o.itemTemplate,o.headerGroupTemplate);n.onSelectionChanged.on(function(e){i.onSelectionChanged(e),i._popup.isVisible&&i._options.multiSelection===!1&&i._popup.close()}),this._popupContent=new e.PopupContentControl(this._dataSource,o.displayExpr,n,o.isVisibleSearchPanel),this._popup=new e.PopupControl(this._popupContent),this._popup.onClosedPopup.on(this.onClosedPopup.bind(this)),this._popup.onOpenedPopup.on(this.onOpenedPopup.bind(this))}return Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},set:function(e){if(this._isInit===!1)throw new Error("The flexWhaleLookup is not initialized");this._dataSource=e,this._popupContent.dataSource=this._dataSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._selectedItems},set:function(e){if(this._isInit===!1)throw new Error("The flexWhaleLookup is not initialized");this._selectedItems=e,this._listControl.selectedItems=this._selectedItems},enumerable:!0,configurable:!0}),t.prototype.onOpenedPopup=function(){this._options.onOpenedPopup&&this._options.onOpenedPopup()},t.prototype.onClosedPopup=function(){this._options.onClosedPopup&&this._options.onClosedPopup()},t.prototype.onSelectionChanged=function(t){this._selectedItems=t,this.drawField(t),this._options.onSelectionChanged&&this._options.onSelectionChanged(new e.SelectedItemsArgs(t))},t.prototype.init=function(){if(this._isInit)throw new Error("Lookup has already been initialized");this._isInit=!0;var e=this;$(window).resize(function(){e._popup.isVisible&&e._popup.close()}),this.createLayout(),this._$rootLayout.on("click",function(t){e.onClickRootLayout(t)}),this._options.onInitialized&&this._options.onInitialized(),void 0!==this._options.selectedItems&&this.onSelectionChanged(this._options.selectedItems),this._$panel.append(this._$rootLayout)},t.prototype.drawField=function(t){if(this._$fieldLayout.empty(),this._$fieldLayout.removeClass("flexWhale-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.removeClass("flexWhale-customContentFieldLayoutLookup"),t.length>0){var o=void 0;this._options.fieldTemplate&&(o=this._options.fieldTemplate(new e.SelectedItemsArgs(t))),void 0===o?o=this._options.multiSelection===!1||this._options.multiSelection&&1===t.length?t[0][this._options.displayExpr]:t.length+this._options.messages.prefixMultiSelectionField:this._$fieldLayout.addClass("flexWhale-customContentFieldLayoutLookup"),this._$fieldLayout.append(o)}else{var i=$("<span>"+this._options.messages.placeholderMessage+"</span>");this._$fieldLayout.addClass("flexWhale-fieldLayoutLookup_noSelectedItems"),this._$fieldLayout.append(i)}},t.prototype.onClickRootLayout=function(e){if(this._popup.isVisible)return this._popupContent.setFocus(),void e.stopPropagation();var t=this;setTimeout(function(){var e=t._$rootLayout.offset(),o=t._$rootLayout.height(),i=t._$rootLayout.outerWidth(),n=t._options.widthPopup?t._options.widthPopup:t._$rootLayout.outerWidth()+"px",s=t._options.heightPopup?t._options.heightPopup:"200px",a=0,l=e.top+o+5;"left"===t._options.startPositionPopup?a=e.left:"right"===t._options.startPositionPopup&&(a=e.left+i-Number(n.replace("px",""))),t._popup.show(a,l,n,s),t._popupContent.setFocus()},1)},t.prototype.createLayout=function(){this._$rootLayout=$("<div/>"),this._$rootLayout.addClass("flexWhale-lookup-rootLayout"),this._$fieldLayout=$("<div/>"),this._$fieldLayout.addClass("flexWhale-fieldLayoutLookup"),this._$rootLayout.append(this._$fieldLayout);var e=$("<div/>");e.addClass("flexWhale-lookup-arrow");var t=$("<div/>");t.addClass("flexWhale-imageLibary-downArrow"),e.append(t),this._$rootLayout.append(e)},t}();e.LookupControl=t}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={}));var FlexWhale;!function(e){var t;!function(e){var t=function(){function e(){this.noDataMessage="No data to display",this.placeholderMessage="Select a value",this.prefixMultiSelectionField=" selected"}return e}();e.Messages=t;var o=function(){function e(e){this.selectedItems=e}return e}();e.SelectedItemsArgs=o;var i=function(){function e(e,t){this.itemsGroup=e,this.captionGroup=t}return e}();e.HeaderGroupTemplateArgs=i;var n=function(){function e(){this.multiSelection=!1,this.messages=new t,this.grouped=!1,this.isVisibleSearchPanel=!0}return e}();e.LookupControlOptions=n}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={}));var FlexWhale;!function(e){var t;!function(e){var t=function(){function t(t){this._isVisible=!1,this._onOpenedPopup=new e.LiteEvent,this._onClosedPopup=new e.LiteEvent,this._popupContent=t}return Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onOpenedPopup",{get:function(){return this._onOpenedPopup},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onClosedPopup",{get:function(){return this._onClosedPopup},enumerable:!0,configurable:!0}),t.prototype.show=function(e,t,o,i){var n=this._$popupWindow=$("<div/>");n.addClass("flexWhale-lookup-popup"),n.append(this._popupContent.getView()),n.css("transform","translate("+e+"px,"+t+"px)"),n.css("width",o),n.css("height",i),n.on("click",function(e){e.stopPropagation()}),this._callbackClosePopup=this.close.bind(this),$("html").one("click",this._callbackClosePopup),$("body").append(n),this._isVisible=!0,this._onOpenedPopup.trigger()},t.prototype.close=function(){this._isVisible=!1,$("html").off("click",this._callbackClosePopup),this._$popupWindow.off("click"),this._callbackClosePopup=null,this._$popupWindow.remove(),this._onClosedPopup.trigger()},t}();e.PopupControl=t}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={})),"undefined"==typeof angular||function(e){e.module("flexWhaleLookup",[]).directive("flexwhaleLookup",function(){return{link:function(e,t,o){var i={grouped:!1,selectedItems:[],widthPopup:void 0,heightPopup:void 0,startPositionPopup:"left",multiSelection:!1,dataSource:[],displayExpr:"",groupExpr:"",isVisibleSearchPanel:!0},n={noDataMessage:"No data to display",placeholderMessage:"Select a value",prefixMultiSelectionField:" items"},s=e.lookupOptions,a=$.extend({},i,s);a.messages=$.extend({},n,s.messages);var l=new FlexWhale.Lookup.LookupControl(t,a);l.init(),e.$watch("lookupDataSource",function(e){void 0!==e&&(l.dataSource=e)}),e.$watch("lookupSelectedItems",function(e){null===e?l.selectedItems=[]:void 0!==e&&(l.selectedItems=e)},!0)},scope:{lookupOptions:"=",lookupSelectedItems:"=",lookupDataSource:"="}}})}(angular);var FlexWhale;!function(e){var t;!function(e){var t=function(){function e(){this._handlers=[]}return e.prototype.on=function(e){this._handlers.push(e)},e.prototype.off=function(e){this._handlers=this._handlers.filter(function(t){return t!==e})},e.prototype.trigger=function(e){this._handlers.slice(0).forEach(function(t){return t(e)})},e}();e.LiteEvent=t}(t=e.Lookup||(e.Lookup={}))}(FlexWhale||(FlexWhale={})),function(e){e.flexWhaleLookup=function(t,o){var i=this;i.$el=e(t),i.el=t,i.$el.data("flexWhaleLookup",i),i.init=function(){i.options=e.extend({},e.flexWhaleLookup.defaultOptions,o),i.options.messages=e.extend({},e.flexWhaleLookup.defaultMessages,o.messages);var n=new FlexWhale.Lookup.LookupControl(t,i.options);n.init(),i.instance=n},Object.defineProperty(i,"dataSource",{get:function(){return i.instance.dataSource},set:function(e){i.instance.dataSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(i,"selectedItems",{get:function(){return i.instance.selectedItems},set:function(e){i.instance.selectedItems=e},enumerable:!0,configurable:!0}),i.init()},e.flexWhaleLookup.defaultMessages={noDataMessage:"No data to display",placeholderMessage:"Select a value",prefixMultiSelectionField:" items"},e.flexWhaleLookup.defaultOptions={grouped:!1,selectedItems:[],widthPopup:void 0,heightPopup:void 0,startPositionPopup:"left",multiSelection:!1,dataSource:[],displayExpr:"",groupExpr:"",isVisibleSearchPanel:!0},e.fn.flexWhaleLookup=function(t){return this.each(function(){new e.flexWhaleLookup(this,t)})}}(jQuery);